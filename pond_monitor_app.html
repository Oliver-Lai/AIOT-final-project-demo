<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§æ± å¡˜æ°´è³ªç›£æ¸¬ç³»çµ± Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .status-bar {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 10px;
            border-right: 2px solid #eee;
        }

        .status-item:last-child {
            border-right: none;
        }

        .status-item .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .status-item .value {
            color: #333;
            font-size: 1.5em;
            font-weight: bold;
        }

        .status-item .unit {
            color: #999;
            font-size: 0.85em;
            margin-left: 3px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background: #4CAF50;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .chart-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .analysis-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .analysis-panel h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .analysis-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            max-height: 600px;
            overflow-y: auto;
        }

        .analysis-content h3 {
            color: #667eea;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .analysis-content h3:first-child {
            margin-top: 0;
        }

        .analysis-content p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .analysis-content ul {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .analysis-content li {
            color: #555;
            line-height: 1.6;
            margin-bottom: 5px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin-bottom: 15px;
            transition: transform 0.2s;
            width: 100%;
        }

        .generate-btn:hover {
            transform: scale(1.05);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .status-bar {
                flex-direction: column;
            }

            .status-item {
                border-right: none;
                border-bottom: 2px solid #eee;
                width: 100%;
            }

            .status-item:last-child {
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŸ æ™ºæ…§æ± å¡˜æ°´è³ªç›£æ¸¬ç³»çµ±</h1>
            <p class="subtitle">å³æ™‚ç›£æ¸¬ Â· æ™ºèƒ½åˆ†æ Â· é è­¦ä¿è­·</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="label">
                    <span class="status-indicator online"></span>ç³»çµ±ç‹€æ…‹
                </div>
                <div class="value">æ­£å¸¸é‹è¡Œ</div>
            </div>
            <div class="status-item">
                <div class="label">ç›£æ¸¬ç«™é»</div>
                <div class="value" id="currentStation">Station 1</div>
            </div>
            <div class="status-item">
                <div class="label">æœ€æ–°æ™‚é–“</div>
                <div class="value" id="currentTime">--</div>
            </div>
            <div class="status-item">
                <div class="label">ç¡é…¸é¹½ (NITRATE)</div>
                <div class="value" id="currentNitrate">--<span class="unit">PPM</span></div>
            </div>
            <div class="status-item">
                <div class="label">é…¸é¹¼å€¼ (PH)</div>
                <div class="value" id="currentPH">--</div>
            </div>
            <div class="status-item">
                <div class="label">æ°¨æ°® (AMMONIA)</div>
                <div class="value" id="currentAmmonia">--<span class="unit">mg/l</span></div>
            </div>
        </div>

        <div class="main-content">
            <div class="chart-container">
                <h2>
                    å³æ™‚æ°´è³ªæ•¸æ“šç›£æ¸¬
                    <span class="badge badge-success">å³æ™‚æ›´æ–°</span>
                </h2>
                <div class="chart-wrapper">
                    <canvas id="waterQualityChart"></canvas>
                </div>
            </div>

            <div class="analysis-panel">
                <h2>ğŸ¤– AI æ°´è³ªåˆ†æå ±å‘Š</h2>
                <button class="generate-btn" id="generateBtn">ç”Ÿæˆæ™ºèƒ½åˆ†æå ±å‘Š</button>
                
                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <p>AI æ­£åœ¨åˆ†ææ°´è³ªæ•¸æ“š...</p>
                </div>

                <div class="analysis-content" id="analysisContent">
                    <p style="color: #999; text-align: center; padding: 40px 0;">
                        é»æ“Šä¸Šæ–¹æŒ‰éˆ•ç”Ÿæˆ AI æ°´è³ªåˆ†æå ±å‘Š
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ± å¡˜æ•¸æ“šï¼ˆå¾ 11-02-2022 00:59 ä¹‹å¾Œï¼‰
        const pondData = [
            {station: "station1", date: "11-02-2022 00:59", nitrate: 22.3, ph: 5.0, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 01:19", nitrate: 9.1, ph: 5.0, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 01:39", nitrate: 19.5, ph: 6.0, ammonia: 0},
            {station: "station1", date: "11-02-2022 01:59", nitrate: 23.9, ph: 5.2, ammonia: 0},
            {station: "station1", date: "11-02-2022 02:19", nitrate: 8.1, ph: 6.0, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 02:39", nitrate: 10.0, ph: 5.4, ammonia: 0},
            {station: "station1", date: "11-02-2022 02:59", nitrate: 29.0, ph: 5.8, ammonia: 0},
            {station: "station1", date: "11-02-2022 03:19", nitrate: 4.1, ph: 5.2, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 03:39", nitrate: 6.2, ph: 5.5, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 03:59", nitrate: 14.5, ph: 5.9, ammonia: 0},
            {station: "station1", date: "11-02-2022 04:19", nitrate: 12.6, ph: 5.0, ammonia: 0},
            {station: "station1", date: "11-02-2022 04:39", nitrate: 9.4, ph: 5.6, ammonia: 0},
            {station: "station1", date: "11-02-2022 04:59", nitrate: 12.5, ph: 5.1, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 05:19", nitrate: 22.7, ph: 5.8, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 05:39", nitrate: 11.7, ph: 5.1, ammonia: 0},
            {station: "station1", date: "11-02-2022 05:59", nitrate: 10.6, ph: 5.8, ammonia: 0},
            {station: "station1", date: "11-02-2022 06:19", nitrate: 22.2, ph: 5.0, ammonia: 0},
            {station: "station1", date: "11-02-2022 06:39", nitrate: 1.7, ph: 5.1, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 06:59", nitrate: 14.7, ph: 5.0, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 07:19", nitrate: 25.0, ph: 5.6, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 07:39", nitrate: 22.4, ph: 5.4, ammonia: 0},
            {station: "station1", date: "11-02-2022 07:59", nitrate: 26.1, ph: 5.9, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 08:19", nitrate: 25.4, ph: 5.3, ammonia: 0},
            {station: "station1", date: "11-02-2022 08:39", nitrate: 12.5, ph: 5.3, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 08:59", nitrate: 10.2, ph: 5.7, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 09:19", nitrate: 22.2, ph: 5.2, ammonia: 0},
            {station: "station1", date: "11-02-2022 09:39", nitrate: 2.8, ph: 5.7, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 09:59", nitrate: 18.5, ph: 6.0, ammonia: 0},
            {station: "station1", date: "11-02-2022 10:19", nitrate: 28.4, ph: 5.6, ammonia: 0.1},
            {station: "station1", date: "11-02-2022 10:39", nitrate: 27.1, ph: 5.9, ammonia: 0},
        ];

        let currentIndex = 0;
        let chart = null;
        let updateInterval = null;

        // åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('waterQualityChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'ç¡é…¸é¹½ (PPM)',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'PH å€¼',
                            data: [],
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'æ°¨æ°® (mg/l)',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y.toFixed(2);
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ™‚é–“'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ç¡é…¸é¹½ (PPM)',
                                color: 'rgb(255, 99, 132)'
                            },
                            grid: {
                                drawOnChartArea: true,
                            },
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'PH å€¼',
                                color: 'rgb(54, 162, 235)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            min: 4.5,
                            max: 6.5
                        },
                        y2: {
                            type: 'linear',
                            display: false,
                            position: 'right',
                            min: 0,
                            max: 0.2
                        }
                    }
                }
            });
        }

        // æ›´æ–°æ•¸æ“š
        function updateData() {
            if (currentIndex >= pondData.length) {
                currentIndex = 0;
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.data.datasets[1].data = [];
                chart.data.datasets[2].data = [];
            }

            const data = pondData[currentIndex];
            const timeLabel = data.date.split(' ')[1];
            
            chart.data.labels.push(timeLabel);
            chart.data.datasets[0].data.push(data.nitrate);
            chart.data.datasets[1].data.push(data.ph);
            chart.data.datasets[2].data.push(data.ammonia);

            // ä¿æŒæœ€å¤šé¡¯ç¤º 15 å€‹æ•¸æ“šé»
            if (chart.data.labels.length > 15) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
                chart.data.datasets[2].data.shift();
            }

            chart.update();

            // æ›´æ–°ç‹€æ…‹æ¬„
            document.getElementById('currentTime').textContent = data.date.split(' ')[1];
            document.getElementById('currentNitrate').innerHTML = data.nitrate.toFixed(1) + '<span class="unit">PPM</span>';
            document.getElementById('currentPH').textContent = data.ph.toFixed(1);
            document.getElementById('currentAmmonia').innerHTML = data.ammonia.toFixed(2) + '<span class="unit">mg/l</span>';

            currentIndex++;
        }

        // ç”Ÿæˆåˆ†æå ±å‘Š
        function generateAnalysis() {
            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loadingDiv');
            const content = document.getElementById('analysisContent');

            btn.disabled = true;
            loading.classList.add('active');
            content.innerHTML = '';

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const recentData = pondData.slice(Math.max(0, currentIndex - 10), currentIndex);
            const avgNitrate = recentData.reduce((sum, d) => sum + d.nitrate, 0) / recentData.length;
            const avgPH = recentData.reduce((sum, d) => sum + d.ph, 0) / recentData.length;
            const avgAmmonia = recentData.reduce((sum, d) => sum + d.ammonia, 0) / recentData.length;
            const maxNitrate = Math.max(...recentData.map(d => d.nitrate));
            const minPH = Math.min(...recentData.map(d => d.ph));

            // æ¨¡æ“¬ AI ç”Ÿæˆå ±å‘Šï¼ˆå»¶é² 2 ç§’ï¼‰
            setTimeout(() => {
                loading.classList.remove('active');
                btn.disabled = false;

                let alertHtml = '';
                if (avgPH < 5.3) {
                    alertHtml = '<div class="alert alert-warning">âš ï¸ è­¦å‘Šï¼šæ°´è³ª PH å€¼åä½ï¼Œå»ºè­°ç«‹å³èª¿æ•´</div>';
                } else {
                    alertHtml = '<div class="alert alert-success">âœ“ æ°´è³ªç‹€æ…‹è‰¯å¥½ï¼Œå„é …æŒ‡æ¨™æ­£å¸¸</div>';
                }

                content.innerHTML = `
                    ${alertHtml}
                    
                    <h3>ğŸ“Š æ•¸æ“šæ‘˜è¦</h3>
                    <p>æ ¹æ“šæœ€è¿‘ ${recentData.length} ç­†ç›£æ¸¬æ•¸æ“šåˆ†æï¼Œç³»çµ±æ–¼ ${recentData[0].date} è‡³ ${recentData[recentData.length-1].date} æœŸé–“æŒçºŒç›£æ¸¬æ± å¡˜æ°´è³ªã€‚</p>
                    
                    <h3>ğŸ”¬ ä¸»è¦æŒ‡æ¨™åˆ†æ</h3>
                    
                    <p><strong>ç¡é…¸é¹½æ¿ƒåº¦ (NITRATE)ï¼š</strong></p>
                    <ul>
                        <li>å¹³å‡å€¼ï¼š${avgNitrate.toFixed(2)} PPM</li>
                        <li>æœ€é«˜å€¼ï¼š${maxNitrate.toFixed(2)} PPM</li>
                        <li>è©•ä¼°ï¼šç¡é…¸é¹½æ¿ƒåº¦åœ¨æ­£å¸¸ç¯„åœå…§ï¼Œ${maxNitrate > 25 ? 'éƒ¨åˆ†æ™‚æ®µç•¥é«˜ï¼Œå»ºè­°åŠ å¼·æ›æ°´' : 'è¡¨ç¤ºæ°´è³ªè‰¯å¥½ï¼Œç‡Ÿé¤Šé¹½å¹³è¡¡'}</li>
                    </ul>
                    
                    <p><strong>é…¸é¹¼å€¼ (PH)ï¼š</strong></p>
                    <ul>
                        <li>å¹³å‡å€¼ï¼š${avgPH.toFixed(2)}</li>
                        <li>æœ€ä½å€¼ï¼š${minPH.toFixed(2)}</li>
                        <li>è©•ä¼°ï¼š${avgPH < 5.3 ? 'âš ï¸ PH å€¼åä½ï¼ˆåé…¸æ€§ï¼‰ï¼Œå¯èƒ½å½±éŸ¿é­šé¡å¥åº·ï¼Œå»ºè­°ä½¿ç”¨ç”ŸçŸ³ç°æˆ–å°è˜‡æ‰“èª¿æ•´' : 'âœ“ PH å€¼é©ä¸­ï¼Œé©åˆæ°´ç”¢é¤Šæ®–'}</li>
                    </ul>
                    
                    <p><strong>æ°¨æ°®æ¿ƒåº¦ (AMMONIA)ï¼š</strong></p>
                    <ul>
                        <li>å¹³å‡å€¼ï¼š${avgAmmonia.toFixed(3)} mg/l</li>
                        <li>è©•ä¼°ï¼š${avgAmmonia > 0.05 ? 'æ°¨æ°®æ¿ƒåº¦ç•¥é«˜ï¼Œå»ºè­°å¢åŠ æ°´é«”æµå‹•æˆ–ä½¿ç”¨ç›Šç”ŸèŒ' : 'âœ“ æ°¨æ°®æ¿ƒåº¦æ¥µä½ï¼Œæ°´è³ªå„ªè‰¯'}</li>
                    </ul>
                    
                    <h3>ğŸ’¡ æ™ºèƒ½å»ºè­°</h3>
                    <ul>
                        ${avgPH < 5.3 ? '<li><strong>ç«‹å³èª¿æ•´ PH å€¼ï¼š</strong>å»ºè­°æ·»åŠ ç”ŸçŸ³ç° 2-3 å…¬æ–¤/ç•ï¼Œæé«˜æ°´é«”é¹¼åº¦</li>' : ''}
                        ${maxNitrate > 25 ? '<li><strong>æ§åˆ¶ç¡é…¸é¹½ï¼š</strong>å¢åŠ æ›æ°´é »ç‡ï¼Œæ¯é€±æ›´æ› 20-30% æ°´é«”</li>' : ''}
                        <li><strong>æŒçºŒç›£æ¸¬ï¼š</strong>å»ºè­°æ¯ 2-4 å°æ™‚æª¢æ¸¬ä¸€æ¬¡æ°´è³ªè®ŠåŒ–</li>
                        <li><strong>é é˜²æªæ–½ï¼š</strong>å®šæœŸæŠ•æ”¾ç›Šç”ŸèŒï¼Œç¶­æŒæ°´é«”å¾®ç”Ÿç‰©å¹³è¡¡</li>
                        ${avgAmmonia < 0.03 ? '<li><strong>å„ªåŒ–é£¼é¤Šï¼š</strong>ç•¶å‰æ°´è³ªæ¢ä»¶è‰¯å¥½ï¼Œå¯é©åº¦å¢åŠ é¤Šæ®–å¯†åº¦</li>' : ''}
                    </ul>
                    
                    <h3>ğŸ“ˆ è¶¨å‹¢é æ¸¬</h3>
                    <p>åŸºæ–¼ç•¶å‰æ•¸æ“šè¶¨å‹¢åˆ†æï¼Œé è¨ˆæœªä¾† 6-12 å°æ™‚å…§ï¼š</p>
                    <ul>
                        <li>ç¡é…¸é¹½æ¿ƒåº¦å°‡ç¶­æŒåœ¨ ${(avgNitrate * 0.9).toFixed(1)}-${(avgNitrate * 1.1).toFixed(1)} PPM ç¯„åœ</li>
                        <li>PH å€¼å¯èƒ½${avgPH < 5.5 ? 'æŒçºŒåä½ï¼Œéœ€è¦äººå·¥å¹²é ' : 'ä¿æŒç©©å®š'}</li>
                        <li>æ°¨æ°®æ¿ƒåº¦é è¨ˆ${avgAmmonia > 0.05 ? 'éœ€è¦å¯†åˆ‡é—œæ³¨' : 'ç¶­æŒä½æ°´å¹³'}</li>
                    </ul>
                    
                    <p style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #eee; color: #999; font-size: 0.9em;">
                        â„¹ï¸ æœ¬å ±å‘Šç”± AI æ™ºèƒ½ç³»çµ±è‡ªå‹•ç”Ÿæˆï¼Œå»ºè­°çµåˆå¯¦åœ°è§€å¯Ÿèˆ‡å°ˆæ¥­åˆ¤æ–·ã€‚
                    </p>
                `;
            }, 2000);
        }

        // äº‹ä»¶ç¶å®š
        document.getElementById('generateBtn').addEventListener('click', generateAnalysis);

        // åˆå§‹åŒ–ä¸¦é–‹å§‹æ›´æ–°
        initChart();
        updateData();
        updateInterval = setInterval(updateData, 2000); // æ¯ 2 ç§’æ›´æ–°ä¸€æ¬¡
    </script>
</body>
</html>
